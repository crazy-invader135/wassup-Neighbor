<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini 3D FPS Without Three.js</title>
<style>
  body { margin:0; overflow:hidden; }
  canvas { display:block; background:#87ceeb; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const map = [
  [1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,1],
  [1,0,0,1,0,0,0,1],
  [1,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1],
];

let player = {x: 3.5, y: 3.5, angle: 0, fov: Math.PI/3};

const keys = {};
document.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

// Mouse look
document.body.addEventListener('click', ()=>document.body.requestPointerLock());
document.addEventListener('pointerlockchange', ()=>{
  if(document.pointerLockElement===document.body){
    document.addEventListener('mousemove', e=>{player.angle += e.movementX*0.002});
  } else {
    document.removeEventListener('mousemove', e=>{player.angle += e.movementX*0.002});
  }
});

function update(){
  const speed = 0.05;
  const dx = Math.cos(player.angle) * speed;
  const dy = Math.sin(player.angle) * speed;
  if(keys['w'] && map[Math.floor(player.y+dy)][Math.floor(player.x+dx)]===0){ player.x+=dx; player.y+=dy; }
  if(keys['s'] && map[Math.floor(player.y-dy)][Math.floor(player.x-dx)]===0){ player.x-=dx; player.y-=dy; }
  if(keys['a'] && map[Math.floor(player.y+dx)][Math.floor(player.x-dy)]===0){ player.x+=dx; player.y-=dy; }
  if(keys['d'] && map[Math.floor(player.y-dx)][Math.floor(player.x+dy)]===0){ player.x-=dx; player.y+=dy; }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const w = canvas.width;
  const h = canvas.height;
  const numRays = 120;
  const stepAngle = player.fov / numRays;
  
  for(let i=0;i<numRays;i++){
    const rayAngle = player.angle - player.fov/2 + i*stepAngle;
    let dist = 0;
    let hit = false;
    let rayX = player.x;
    let rayY = player.y;
    while(!hit && dist<20){
      rayX += Math.cos(rayAngle)*0.05;
      rayY += Math.sin(rayAngle)*0.05;
      dist += 0.05;
      if(map[Math.floor(rayY)][Math.floor(rayX)]===1) hit=true;
    }
    const lineHeight = h / (dist + 0.0001);
    ctx.strokeStyle = 'black';
    ctx.beginPath();
    ctx.moveTo(i*(w/numRays), h/2 - lineHeight/2);
    ctx.lineTo(i*(w/numRays), h/2 + lineHeight/2);
    ctx.stroke();
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
