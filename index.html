<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test Floor & Walls</title>
<style>
  body { margin:0; overflow:hidden; }
  canvas { display:block; cursor: crosshair; }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,2,10);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lighting
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(5,10,5);
scene.add(dirLight);

// Floor (solid color for testing)
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(50,50),
  new THREE.MeshStandardMaterial({ color: 0x228B22 }) // green
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// Walls
const wallMat = new THREE.MeshStandardMaterial({color:0x8B4513});
let walls = [];
function addWall(x,z,w,h,d){
  const wall = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), wallMat);
  wall.position.set(x,h/2,z);
  scene.add(wall);
  walls.push(wall);
}
addWall(0,-25,50,3,1);
addWall(0,25,50,3,1);
addWall(-25,0,1,3,50);
addWall(25,0,1,3,50);

// PointerLockControls
const controls = new THREE.PointerLockControls(camera, renderer.domElement);
renderer.domElement.addEventListener('click',()=>controls.lock());

// Movement
const move = {forward:false,backward:false,left:false,right:false};
document.addEventListener('keydown',e=>{
  if(e.code==='KeyW') move.forward=true;
  if(e.code==='KeyS') move.backward=true;
  if(e.code==='KeyA') move.left=true;
  if(e.code==='KeyD') move.right=true;
});
document.addEventListener('keyup',e=>{
  if(e.code==='KeyW') move.forward=false;
  if(e.code==='KeyS') move.backward=false;
  if(e.code==='KeyA') move.left=false;
  if(e.code==='KeyD') move.right=false;
});

// Simple collision
function checkCollision(pos){
  const radius = 0.5;
  for(const wall of walls){
    const dx = Math.max(wall.position.x - wall.geometry.parameters.width/2, Math.min(pos.x, wall.position.x + wall.geometry.parameters.width/2));
    const dz = Math.max(wall.position.z - wall.geometry.parameters.depth/2, Math.min(pos.z, wall.position.z + wall.geometry.parameters.depth/2));
    if(Math.hypot(pos.x-dx,pos.z-dz)<radius) return true;
  }
  return false;
}

// Animate
const speed = 0.1;
function animate(){
  requestAnimationFrame(animate);
  const dir = new THREE.Vector3();
  if(move.forward) dir.z -= speed;
  if(move.backward) dir.z += speed;
  if(move.left) dir.x -= speed;
  if(move.right) dir.x += speed;
  const newPos = controls.getObject().position.clone();
  newPos.x += dir.x;
  newPos.z += dir.z;
  if(!checkCollision(newPos)){
    controls.moveRight(dir.x);
    controls.moveForward(dir.z);
  }
  renderer.render(scene,camera);
}
animate();

// Resize
window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
